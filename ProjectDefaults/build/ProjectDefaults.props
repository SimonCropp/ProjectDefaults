<?xml version="1.0" encoding="utf-8"?>
<Project>
  <PropertyGroup>
    <SolutionDir Condition="'$(SolutionDir)'==''">$(ProjectDir)..\</SolutionDir>
    <TreatWarningsAsErrors Condition="$(TreatWarningsAsErrors) == ''">true</TreatWarningsAsErrors>
    <LangVersion Condition="$(LangVersion) == ''">10.0</LangVersion>
    <AssemblyOriginatorKeyFile>$(SolutionDir)key.snk</AssemblyOriginatorKeyFile>
    <SignAssembly Condition="$(SignAssembly) != false">true</SignAssembly>
    <DebugType Condition="$(DebugType) == ''">embedded</DebugType>
    <DebugSymbols>true</DebugSymbols>
    <GeneratePackageOnBuild Condition="'$(GeneratePackageOnBuild)' == '' and $(Configuration) == 'Release'">true</GeneratePackageOnBuild>
    <RepoDir>$(SolutionDir)</RepoDir>
    <RepoDir Condition="Exists('$(SolutionDir)..\.git')">$(SolutionDir)..\</RepoDir>
    <!--
    IDE0044: dont recommend private fields
    -->
    <NoWarn>$(NoWarn);IDE0044;CA1050</NoWarn>
    <Nullable Condition="'$(Nullable)' != 'disable'">enable</Nullable>
    <RunAnalyzers Condition="$(Configuration) != 'Release'">false</RunAnalyzers>
    <RunAnalyzersDuringBuild Condition="$(Configuration) != 'Release'">false</RunAnalyzersDuringBuild>
    <RunAnalyzersDuringLiveAnalysis Condition="$(Configuration) != 'Release'">false</RunAnalyzersDuringLiveAnalysis>
    <AnalysisLevel>5</AnalysisLevel>
    <ImplicitUsings Condition="'$(ImplicitUsings)' == ''">enable</ImplicitUsings>
    <SatelliteResourceLanguages>en-US</SatelliteResourceLanguages>
  </PropertyGroup>

  <PropertyGroup
    Condition="$(MSBuildProjectName.EndsWith('.Tests')) or $(MSBuildProjectName.Contains('Sample')) or '$(MSBuildProjectName)' == 'Tests' or '$(MSBuildProjectName)' == 'Helpers' or '$(MSBuildProjectName)' == 'Shared' or '$(MSBuildProjectName)' == 'Snippets'">
    <GeneratePackageOnBuild>false</GeneratePackageOnBuild>
  </PropertyGroup>

  <PropertyGroup
    Condition="$(GeneratePackageOnBuild)">
    <PackageOutputPath>$(RepoDir)nugets</PackageOutputPath>
    <PackageLicenseExpression
      Condition="'$(PackageLicenseUrl)' == '' And '$(PackageLicenseFile)' == '' And '$(PackageLicenseExpression)' == '' " >MIT</PackageLicenseExpression>
    <Copyright>Copyright $([System.DateTime]::UtcNow.ToString(yyyy)). All rights reserved</Copyright>
    <PublishRepositoryUrl>true</PublishRepositoryUrl>
    <NoPackageAnalysis>true</NoPackageAnalysis>
    <GenerateDocumentationFile>true</GenerateDocumentationFile>
    <ContinuousIntegrationBuild
      Condition="'$(ContinuousIntegrationBuild)' == '' And $(APPVEYOR) == true">true</ContinuousIntegrationBuild>
  </PropertyGroup>

  <PropertyGroup Condition="!$(GeneratePackageOnBuild)">
    <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
  </PropertyGroup>

  <ItemGroup>
    <Using Remove="System.Net.Http" />
  </ItemGroup>
  <ItemGroup
    Condition="$(GeneratePackageOnBuild)">
    <None Include="$(SolutionDir)..\src\icon.png" Pack="true" PackagePath="\"/>
  </ItemGroup>

  <Target
      Name="ProjectDefaultsUpdateNuspec"
      BeforeTargets="GenerateNuspec"
      Condition="$(GeneratePackageOnBuild)"
    >
    <Warning
       Text="No 'ScmRepositoryUrl' defined."
       Condition="'$(ScmRepositoryUrl)' == '' And $(GeneratePackageOnBuild)" />
    <PropertyGroup>
      <RepositoryUrlEx>$(ScmRepositoryUrl.Replace('.git', ''))</RepositoryUrlEx>
      <PackageProjectUrl Condition="$(PackageProjectUrl) == ''">$(RepositoryUrlEx.Replace('.git', ''))</PackageProjectUrl>
      <PackageIcon>icon.png</PackageIcon>
      <Authors>$(RepositoryUrlEx)/graphs/contributors</Authors>
    </PropertyGroup>
  </Target>
  <!-- Disable default Inbox Source Generators
       https://github.com/dotnet/sdk/issues/21006
       https://github.com/dotnet/designs/blob/main/accepted/2021/InboxSourceGenerators.md -->
  <Target Name="DisableAnalyzers"
          BeforeTargets="CoreCompile"
          Condition="$(EnableAnalyzers) != true">
    <ItemGroup>
      <Analyzer Remove="@(Analyzer)" />
    </ItemGroup>
  </Target>
</Project>