<?xml version="1.0" encoding="utf-8"?>
<Project>
  <PropertyGroup>
    <SolutionDir Condition="'$(SolutionDir)'==''">$(ProjectDir)..\</SolutionDir>
    <TreatWarningsAsErrors Condition="$(TreatWarningsAsErrors) == ''">true</TreatWarningsAsErrors>
    <LangVersion Condition="$(LangVersion) == ''">11.0</LangVersion>
    <AssemblyOriginatorKeyFile>$(SolutionDir)key.snk</AssemblyOriginatorKeyFile>
    <SignAssembly Condition="$(SignAssembly) != false">true</SignAssembly>
    <DebugType Condition="$(DebugType) == ''">embedded</DebugType>
    <DebugSymbols>true</DebugSymbols>
    <IsPackageProject Condition="'$(IsPackageProject)' == '' And $(Configuration) == 'Release'">true</IsPackageProject>
    <RepoDir>$(SolutionDir)</RepoDir>
    <RepoDir Condition="Exists('$(SolutionDir)..\.git')">$(SolutionDir)..\</RepoDir>
    <!--
    IDE0044: dont recommend private fields
    -->
    <NoWarn>$(NoWarn);IDE0044;CA1050</NoWarn>
    <Nullable Condition="'$(Nullable)' != 'disable'">enable</Nullable>
    <RunAnalyzers Condition="$(Configuration) != 'Release'">false</RunAnalyzers>
    <RunAnalyzersDuringBuild Condition="$(Configuration) != 'Release'">false</RunAnalyzersDuringBuild>
    <RunAnalyzersDuringLiveAnalysis Condition="$(Configuration) != 'Release'">false</RunAnalyzersDuringLiveAnalysis>
    <AnalysisLevel>5</AnalysisLevel>
    <ImplicitUsings Condition="'$(ImplicitUsings)' == ''">enable</ImplicitUsings>
    <SatelliteResourceLanguages>en-US</SatelliteResourceLanguages>
    <SuppressNETCoreSdkPreviewMessage>true</SuppressNETCoreSdkPreviewMessage>
    <CheckEolTargetFramework>false</CheckEolTargetFramework>
  </PropertyGroup>

  <PropertyGroup
    Condition="$(MSBuildProjectName.EndsWith('.Tests')) Or $(MSBuildProjectName.Contains('Sample')) Or '$(MSBuildProjectName)' == 'Tests' Or '$(MSBuildProjectName)' == 'Helpers' Or '$(MSBuildProjectName)' == 'Shared' Or '$(MSBuildProjectName)' == 'Snippets'">
    <IsPackageProject>false</IsPackageProject>
  </PropertyGroup>

  <PropertyGroup
    Condition="$(IsPackageProject) == true And $(Configuration) == 'Release'">
    <PackageOutputPath>$(RepoDir)nugets</PackageOutputPath>
    <PackageLicenseExpression
      Condition="'$(PackageLicenseUrl)' == '' And '$(PackageLicenseFile)' == '' And '$(PackageLicenseExpression)' == '' " >MIT</PackageLicenseExpression>
    <Copyright>Copyright $([System.DateTime]::UtcNow.ToString(yyyy)). All rights reserved</Copyright>
    <PublishRepositoryUrl>true</PublishRepositoryUrl>
    <NoPackageAnalysis>true</NoPackageAnalysis>
    <GeneratePackageOnBuild>true</GeneratePackageOnBuild>
    <EmbedUntrackedSources>true</EmbedUntrackedSources>
    <GenerateDocumentationFile>true</GenerateDocumentationFile>
    <ContinuousIntegrationBuild
      Condition="'$(ContinuousIntegrationBuild)' == '' And $(APPVEYOR) == true">true</ContinuousIntegrationBuild>
  </PropertyGroup>

  <PropertyGroup Condition="$(IsPackageProject) == false">
    <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
  </PropertyGroup>

  <ItemGroup>
    <Using Remove="System.Net.Http" />
    <Using Include="System.Threading.CancellationToken"
           Alias="Cancellation" />
    <Using Include="System.Threading.CancellationTokenSource"
           Alias="CancellationSource" />
  </ItemGroup>
  <ItemGroup
    Condition="$(IsPackageProject) == true And $(Configuration) == 'Release'">
    <None Include="$(SolutionDir)..\src\icon.png" Pack="true" PackagePath="\"/>
  </ItemGroup>

  <ItemGroup Condition="$(TargetFramework.StartsWith('net6')) OR $(TargetFramework.StartsWith('net7')) OR $(TargetFramework.StartsWith('net8'))">
    <Using Include="System.DateOnly" Alias="Date" />
    <Using Include="System.TimeOnly" Alias="Time" />
  </ItemGroup>

  <Target
      Name="ProjectDefaultsUpdateNuspec"
      BeforeTargets="GenerateNuspec"
      Condition="$(GeneratePackageOnBuild)"
    >
    <PropertyGroup>
      <RepositoryUrlEx>$(ScmRepositoryUrl.Replace('.git', ''))</RepositoryUrlEx>
      <PackageProjectUrl Condition="$(PackageProjectUrl) == ''">$(RepositoryUrlEx.Replace('.git', ''))</PackageProjectUrl>
      <PackageIcon>icon.png</PackageIcon>
      <Authors>$(RepositoryUrlEx)/graphs/contributors</Authors>
    </PropertyGroup>
  </Target>
  <!-- Disable default Inbox Source Generators
       https://github.com/dotnet/sdk/issues/21006
       https://github.com/dotnet/designs/blob/main/accepted/2021/InboxSourceGenerators.md -->
  <Target Name="DisableAnalyzers"
          BeforeTargets="CoreCompile"
          Condition="$(EnableAnalyzers) != true">
    <ItemGroup>
      <Analyzer Remove="@(Analyzer)" />
    </ItemGroup>
  </Target>
</Project>