<?xml version="1.0" encoding="utf-8"?>
<Project>
  <Target
      Name="ProjectDefaultsUpdateNuspec"
      BeforeTargets="GenerateNuspec"
      Condition="$(GeneratePackageOnBuild)"
    >
    <Error
       Text="No 'RepositoryUrl' defined."
       Condition="'$(RepositoryUrl)' == '' And $(IsPackageProject) == true And $(Configuration) == 'Release'" />
    <PropertyGroup>
      <RepositoryUrlEx>$(RepositoryUrl.Replace('.git', ''))</RepositoryUrlEx>
      <PackageProjectUrl Condition="$(PackageProjectUrl) == ''">$(RepositoryUrlEx.Replace('.git', ''))</PackageProjectUrl>
      <PackageReleaseNotes>$(RepositoryUrlEx)/milestones?state=closed</PackageReleaseNotes>
      <PackageIconUrl>$(RepositoryUrlEx.Replace('https://github.com', '%(SourceLinkGitHubHost.ContentUrl)'))/master/src/icon.png</PackageIconUrl>
      <Authors>$(RepositoryUrlEx)/graphs/contributors</Authors>
    </PropertyGroup>
  </Target>
  <ItemGroup>
    <None Update="**\*.approved.*"
          DependentUpon="$(
  [System.String]::Copy('%(FileName)')
    .SubString(
      0,
      $([System.String]::Copy('%(FileName)').IndexOf('.'))
    )
).cs" />
  </ItemGroup>
</Project>